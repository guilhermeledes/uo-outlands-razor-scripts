@setvar action_delay_var 250

# MASTERY CHAIN LINKS
if not listexists 'links'
    createlist 'links'
    @pushlist 'links' 'chain link'
endif

# RARES
if not listexists 'rares'
    sysmsg 'Creating rares list...' 51
    createlist 'rares'
    # mastery chain links
    # skill orb
    @pushlist 'rares' 22336
    # # mcd (this goes into the resource stockpile)
    @pushlist 'rares' 17087
    # research materials
    @pushlist 'rares' 24434
    @pushlist 'rares' 29348
    # spell hue deeds
    @pushlist 'rares' 5359
    # rare cloth
    @pushlist 'rares' 'folded cloth'
    @pushlist 'rares' 'map'
    # skill scrolls
    @pushlist 'rares' 'scroll of calling'
    @pushlist 'rares' 'aspect core'
    # aspect extract
    @pushlist 'rares' 3836
    @pushlist 'rares' 'phylactery'
    # runebook dye
    @pushlist 'rares' 3838
    # backpack dye
    @pushlist 'rares' 3839
    # headwear dye
    @pushlist 'rares' 3842
    # facial hair dye
    @pushlist 'rares' 3843
    # hair, shield and quiver dye
    @pushlist 'rares' 3843
    # fortuniture dye
    @pushlist 'rares' 29025
    # carpet dye
    @pushlist 'rares' 29036
endif

# ARCANE RUNES
if not listexists 'arcane_runes'
    sysmsg 'Creating arcane runes list...' 51
    createlist 'arcane_runes'
    @pushlist 'arcane_runes' 39891
    @pushlist 'arcane_runes' 39892
    @pushlist 'arcane_runes' 39917
    @pushlist 'arcane_runes' 39909
    @pushlist 'arcane_runes' 39912
    @pushlist 'arcane_runes' 39905
    @pushlist 'arcane_runes' 39911
    @pushlist 'arcane_runes' 39897
    @pushlist 'arcane_runes' 39918
    @pushlist 'arcane_runes' 39889
    @pushlist 'arcane_runes' 39898
    @pushlist 'arcane_runes' 39896
    @pushlist 'arcane_runes' 39916
endif

# MISC TCHEST ITEMS
removelist 'tchest_items'
if not listexists 'tchest_items'
    sysmsg 'Creating regular tchest items list...' 51
    createlist 'tchest_items'

    # MISC
    @pushlist 'tchest_items' 'clean bandage%s%'
    @pushlist 'tchest_items' 'arrow'
    @pushlist 'tchest_items' 'crossbow bolt'
    @pushlist 'tchest_items' 'gold coin'
    @pushlist 'tchest_items' 'seed of renewal'
    @pushlist 'tchest_items' 'bag of seeds'
    @pushlist 'tchest_items' 'blank scroll%s%'

    # GEMS
    @pushlist 'tchest_items' 'rub%ies/y%'
    @pushlist 'tchest_items' 'tourmaline%s%'
    @pushlist 'tchest_items' 'emerald%s%'
    @pushlist 'tchest_items' 'diamond%s%'
    @pushlist 'tchest_items' 'piece%s% of amber'
    @pushlist 'tchest_items' 'amethyst%s%'
    @pushlist 'tchest_items' 'star sapphire%s%'
    @pushlist 'tchest_items' 'citrine%s%'
    @pushlist 'tchest_items' 'sapphire%s%'

    # HATS
    @pushlist 'tchest_items' "wizard's hat"

    # REAGENTS
    @pushlist 'tchest_items' 'Blood Moss'
    @pushlist 'tchest_items' 'Black Pearl%s%'
    @pushlist 'tchest_items' 'Garlic'
    @pushlist 'tchest_items' 'Mandrake Root%s%'
    @pushlist 'tchest_items' 'Ginseng'
    @pushlist 'tchest_items' 'Nightshade'
    @pushlist 'tchest_items' 'Sulfurous Ash'
    @pushlist 'tchest_items' "Spider's Silk"

    # MAGERY SCROLLS
    @pushlist 'tchest_items' 'Recall Scroll'
    @pushlist 'tchest_items' 'ManaDrain Scroll'
    @pushlist 'tchest_items' 'Greater Heal Scroll'
    @pushlist 'tchest_items' 'Lightning Scroll'
    @pushlist 'tchest_items' 'Lightning Scroll'

    # MAGIC ITEMS
    @pushlist 'tchest_items' "martial arts scroll"
    @pushlist 'tchest_items' "halberd"
    @pushlist 'tchest_items' "bardiche"
    @pushlist 'tchest_items' "battle axe"
    @pushlist 'tchest_items' "double axe"
    @pushlist 'tchest_items' "two handed axe"
    @pushlist 'tchest_items' "executioner's axe"
    @pushlist 'tchest_items' "large battle axe"
    @pushlist 'tchest_items' "axe"
    @pushlist 'tchest_items' "scimitar"
    @pushlist 'tchest_items' "longsword"
    @pushlist 'tchest_items' "viking sword"
    @pushlist 'tchest_items' "katana"
    @pushlist 'tchest_items' "cutlass"
    @pushlist 'tchest_items' "broadsword"
    @pushlist 'tchest_items' "war hammer"
    @pushlist 'tchest_items' "war axe"
    @pushlist 'tchest_items' "maul"
    @pushlist 'tchest_items' "quarter staff"
    @pushlist 'tchest_items' "gnarled staff"
    @pushlist 'tchest_items' "black staff"
    @pushlist 'tchest_items' "hammer pick"
    @pushlist 'tchest_items' "club"
    @pushlist 'tchest_items' "shepherd's crook"
    @pushlist 'tchest_items' "war mace"
    @pushlist 'tchest_items' "mace"
    @pushlist 'tchest_items' "Long Spear"
    @pushlist 'tchest_items' "pitchfork"
    @pushlist 'tchest_items' "war fork"
    @pushlist 'tchest_items' "kryss"
    @pushlist 'tchest_items' "short spear"
    @pushlist 'tchest_items' "bow"
    @pushlist 'tchest_items' "crossbow"
    @pushlist 'tchest_items' "heavy crossbow"
    @pushlist 'tchest_items' "bladed staff"
    @pushlist 'tchest_items' "leather tunic"
    @pushlist 'tchest_items' "leather leggings"
    @pushlist 'tchest_items' "leather sleeves"
    @pushlist 'tchest_items' "leather cap"
    @pushlist 'tchest_items' "leather gloves"
    @pushlist 'tchest_items' "leather gorget"
    @pushlist 'tchest_items' "leather armor"
    @pushlist 'tchest_items' "leather bustier"
    @pushlist 'tchest_items' "leather shorts"
    @pushlist 'tchest_items' "leather skirt"
    @pushlist 'tchest_items' "studded tunic"
    @pushlist 'tchest_items' "studded leggings"
    @pushlist 'tchest_items' "studded sleeves"
    @pushlist 'tchest_items' "studded gloves"
    @pushlist 'tchest_items' "studded gorget"
    @pushlist 'tchest_items' "studded armor"
    @pushlist 'tchest_items' "studded bustier"
    @pushlist 'tchest_items' "bone armor"
    @pushlist 'tchest_items' "bone legs"
    @pushlist 'tchest_items' "bone arms"
    @pushlist 'tchest_items' "bone helmet"
    @pushlist 'tchest_items' "bone gloves"
    @pushlist 'tchest_items' "ringmail tunic"
    @pushlist 'tchest_items' "ringmail leggings"
    @pushlist 'tchest_items' "ringmail sleeves"
    @pushlist 'tchest_items' "helmet"
    @pushlist 'tchest_items' "ringmail gloves"
    @pushlist 'tchest_items' "orc helm"
    @pushlist 'tchest_items' "chainmail tunic"
    @pushlist 'tchest_items' "chainmail leggings"
    @pushlist 'tchest_items' "chainmail coif"
    @pushlist 'tchest_items' "platemail"
    @pushlist 'tchest_items' "platemail legs"
    @pushlist 'tchest_items' "platemail arms"
    @pushlist 'tchest_items' "plate helm"
    @pushlist 'tchest_items' "platemail gloves"
    @pushlist 'tchest_items' "platemail gorget"
    @pushlist 'tchest_items' "plate armor"
    @pushlist 'tchest_items' "bascinet"
    @pushlist 'tchest_items' "close helm"
    @pushlist 'tchest_items' "norse helm"
    @pushlist 'tchest_items' "wooden shield"
    @pushlist 'tchest_items' "kite shield"
    @pushlist 'tchest_items' "buckler "
    @pushlist 'tchest_items' "buckler"
    @pushlist 'tchest_items' "metal shield"
    @pushlist 'tchest_items' "bronze shield"
    @pushlist 'tchest_items' "kite shield"
    @pushlist 'tchest_items' "heater shield"
    @pushlist 'tchest_items' "Chaos shield"
    @pushlist 'tchest_items' "Order shield"
    @pushlist 'tchest_items' "lap harp"
    @pushlist 'tchest_items' "drum"
    @pushlist 'tchest_items' "lute"
    @pushlist 'tchest_items' "bamboo flute"
    @pushlist 'tchest_items' "tambourine"
    @pushlist 'tchest_items' "spellbook"
    @pushlist 'tchest_items' "wand"

endif

# search for tchests in the ground to start the whole process
unsetvar chest

if findtype 29089 ground any any 2 as tchest
    setvar chest tchest
elseif findtype 29076 ground any any 2 as tchest
    setvar chest tchest
else
    overhead 'NO CHESTS NEARBY!' 43
    sysmsg 'Cant find any Treasure Chest nearby!' 43
endif

clearsysmsg

if varexist chest
    dclick chest

    sysmsg 'Starting Looting Chest...'
    foreach item in 'links'
        while findtype item chest any any as item_to_unload
            getlabel item_to_unload desc
            if public = 1
                say desc
            else
                overhead desc
            endif

            lift item_to_unload 1
            wait action_delay_var
            drop loot_bag
            wait action_delay_var
        endwhile
    endfor

    foreach item in 'rares'
        while findtype item chest any any as item_to_unload
            getlabel item_to_unload desc
            if public = 1
                say desc
            else
                overhead desc
            endif

            lift item_to_unload 60000
            wait action_delay_var
            drop loot_bag
            wait action_delay_var
        endwhile
    endfor

    foreach item in 'arcane_runes'
        while findtype item chest any any as item_to_unload
            getlabel item_to_unload desc
            if public = 1
                say desc
            else
                overhead desc
            endif
            
            lift item_to_unload 60000
            wait action_delay_var
            drop loot_bag
            wait action_delay_var
        endwhile
    endfor

    foreach item in 'tchest_items'
        while findtype item chest any any as item_to_unload
            getlabel item_to_unload desc
            if public = 1
                say desc
            else
                overhead desc
            endif
            
            lift item_to_unload 60000
            wait action_delay_var
            drop loot_bag
            wait action_delay_var
        endwhile
    endfor


    sysmsg 'LOOT CHEST FINISHED'

    @clearignore
    @clearsysmsg 
    
endif